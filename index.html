<html>
<head>
  <title>A Leaflet map!</title>
  <link rel="stylesheet" href="https://npmcdn.com/leaflet@0.7.7/dist/leaflet.css" />
  <script src="https://npmcdn.com/leaflet@0.7.7/dist/leaflet.js"></script>
  <!-- <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css"/>
  <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script> -->
  <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script type="text/javascript" src="OD.js"></script>
  <script type="text/javascript" src="zones.js"></script>
  <style>
    #map{ height: 100% }
    .slidecontainer {
    width: 100%;
}

.slider {
    -webkit-appearance: none;
    width: 100%;
    height: 15px;
    border-radius: 5px;
    background: #d3d3d3;
    outline: none;
    opacity: 0.7;
    -webkit-transition: .2s;
    transition: opacity .2s;
}

.slider:hover {
    opacity: 1;
}

.slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 25px;
    height: 25px;
    border-radius: 50%;
    background: #4CAF50;
    cursor: pointer;
}

.slider::-moz-range-thumb {
    width: 25px;
    height: 25px;
    border-radius: 50%;
    background: #4CAF50;
    cursor: pointer;
}
  </style>
</head>
<body>
 
  <div id="map"></div>

  <h1>Residential</h1>
  <div class="""slidecontainer">
    <input type="range" min="0" max="10" value="0" class="slider" id="resRange">
    <p>Value: <span id="resVal"></span></p>
  </div>

  <h1>Office</h1>
  <div class="""slidecontainer">
    <input type="range" min="0" max="10" value="0" class="slider" id="offRange">
    <p>Value: <span id="offVal"></span></p>
  </div>
 
  <script>
  console.log(od.length)
  console.log(od[1][1])

 
  // initialize the map
  var map = L.map('map').setView([42.506317 , 1.521835], 13);
 
  // load a tile layer
  L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions">CartoDB</a>',
    subdomains: 'abcd',
    maxZoom: 19
  }).addTo(map);

  //get the max trips and max self flows
  var maxTrips=0;
  var maxSelf=0;
  for (i=0; i<od.length; i++){
		for (j=0; j<od.length; j++){
			if (i==j){
				if (od[i][j]>maxSelf){
					maxSelf=od[i][j];
				}
			}
			else {
				if (od[i][j]>maxTrips){
					maxTrips=od[i][j];
				}
			}
		}
	}

  
  // var max = Math.max.apply(null, od.map(function(row){ return Math.max.apply(Math, row); }));

  function getPointColor(d) {
    return d > 0.9 ? '#800026' :
        d > 0.8  ? '#BD0026' :
        d > 0.7  ? '#E31A1C' :
        d > 0.6  ? '#FC4E2A' :
        d > 0.5   ? '#FD8D3C' :
        d > 0.4   ? '#FEB24C' :
        d > 0.3   ? '#FED976' :
              '#FFEDA0';
  }
  function getPointStyle(d) {
    var options = {
      radius: 8*d,
      fillColor: getPointColor(d),
      color: "#000",
      weight: 1,
      opacity: 1,
      fillOpacity: 0.8
      };
    return options
  }

  function getLineStyle(d) {
    var options = {
      color: getPointColor(d),
      weight: 5*d,
      opacity: 0.3
      };
    return options
  }
    
 //  $.getJSON("zones.geojson",function(zoneData){
 //    L.geoJson( zoneData,{
 //      pointToLayer: function (feature, latlng) {
 //        var id = parseInt(feature.properties.id)
 //        console.log(id)
 //        var selfFlow= od[id][id]
 //        return L.circleMarker(latlng, getPointStyle(Math.sqrt(selfFlow/maxSelf)));
 //    }
	// }).addTo(map);
 //  });
  zoneCircs=L.featureGroup().addTo(map);

  for (i=0; i<od.length; i++){
    var selfFlow= od[i][i]
    var loc= new L.LatLng(zones.features[i].geometry.coordinates[1], zones.features[i].geometry.coordinates[0])
    var circ =L.circleMarker(loc, getPointStyle(Math.sqrt(selfFlow/maxSelf)));
    circ.addTo(zoneCircs);
  }

  lines=L.featureGroup().addTo(map);

	for (i=0; i<od.length; i++){
		for (j=0; j<od.length; j++){
			if (i!=j){
				var trips=od[i][j]
				if (trips>0){
					var line = [
					new L.LatLng(zones.features[i].geometry.coordinates[1], zones.features[i].geometry.coordinates[0]),
					new L.LatLng(zones.features[j].geometry.coordinates[1], zones.features[j].geometry.coordinates[0])]
					var polyline = new L.Polyline(line, getLineStyle(Math.sqrt(trips/maxTrips)));
          polyline.addTo(lines)
					// map.addLayer(polyline);
				}

			}
		}
	}

  var resSlider = document.getElementById("resRange");
  var resOutput = document.getElementById("resVal");
  resOutput.innerHTML = resSlider.value;
  

  var offSlider = document.getElementById("offRange");
  var offOutput = document.getElementById("offVal");
  offOutput.innerHTML = offSlider.value;

  function updateMap(res, off){
    map.removeLayer(lines);
    map.removeLayer(zoneCircs);


  }

  resSlider.oninput = function() {
    resOutput.innerHTML = this.value;
    updateMap(resOutput, offOutput);
    console.log(resOutput)
    console.log(offOutput)
  }

  
  offSlider.oninput = function() {
    offOutput.innerHTML = this.value;
  }
 
  </script>
</body>
</html>